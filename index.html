<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BEAMOVE</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<!-- Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
:root{
--offwhite:#F6F1EC;
--marrom:#6B4C3B;
--marrom-escuro:#3E2A22;
--rose:#C49A8A;
}

body{
margin:0;
font-family:'Poppins',sans-serif;
background:var(--offwhite);
color:var(--marrom-escuro);
transition:0.3s;
}

.dark{
background:#1e1e1e;
color:#f5f5f5;
}

.dark .post,
.dark .chat-box,
.dark .profile-card{
background:#2c2c2c;
}

header{
padding:15px;
font-weight:700;
display:flex;
justify-content:space-between;
align-items:center;
}

button{
background:var(--marrom);
color:white;
border:none;
padding:10px;
border-radius:10px;
cursor:pointer;
}

input,textarea{
width:100%;
padding:10px;
margin:5px 0;
border-radius:10px;
border:1px solid #ddd;
}

.hidden{display:none;}

.slider{
display:flex;
overflow-x:auto;
gap:10px;
padding:10px;
}

.story{
min-width:90px;
height:90px;
background:linear-gradient(45deg,var(--rose),var(--marrom));
border-radius:20px;
display:flex;
align-items:center;
justify-content:center;
color:white;
font-size:12px;
}

.post{
background:white;
margin:15px;
padding:15px;
border-radius:20px;
box-shadow:0 5px 15px rgba(0,0,0,0.05);
animation:fadeIn 0.5s ease;
}

@keyframes fadeIn{
from{opacity:0;transform:translateY(10px);}
to{opacity:1;transform:translateY(0);}
}

.chat-box{
height:300px;
overflow-y:auto;
margin:10px;
padding:10px;
background:white;
border-radius:15px;
}

.message{
margin-bottom:8px;
font-size:13px;
}

.profile-card{
text-align:center;
padding:20px;
background:white;
border-radius:20px;
margin:15px;
}

.profile-img{
width:100px;
height:100px;
border-radius:50%;
background:linear-gradient(45deg,var(--rose),var(--marrom));
margin:auto;
}

.settings{
position:absolute;
right:15px;
cursor:pointer;
}

nav{
position:fixed;
bottom:0;
width:100%;
display:flex;
justify-content:space-around;
padding:10px 0;
background:white;
box-shadow:0 -2px 10px rgba(0,0,0,0.05);
}
.dark nav{background:#2c2c2c;}
</style>
</head>

<body>

<header>
<span>BEAMOVE</span>
</header>

<!-- LOGIN -->
<div id="loginScreen">
<input type="email" id="loginEmail" placeholder="Email">
<input type="password" id="loginPassword" placeholder="Senha">
<button onclick="login()">Entrar</button>
<button onclick="showRegister()">Criar Conta</button>
</div>

<!-- REGISTER -->
<div id="registerScreen" class="hidden">
<input type="text" id="username" placeholder="@usuario obrigatório">
<input type="email" id="registerEmail" placeholder="Email">
<input type="password" id="registerPassword" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
<button onclick="showLogin()">Voltar</button>
</div>

<!-- APP -->
<div id="appScreen" class="hidden">

<!-- HOME -->
<div id="home">
<div class="slider">
<div class="story">Treinos</div>
<div class="story">Receitas</div>
<div class="story">Dietas</div>
</div>

<div id="feed"></div>

<input type="text" id="postInput" placeholder="Compartilhe algo...">
<button onclick="addPost()">Publicar</button>
</div>

<!-- COMUNIDADE -->
<div id="comunidade" class="hidden">
<div class="chat-box" id="chatBox"></div>
<input type="text" id="chatInput" placeholder="Mensagem...">
<button onclick="sendMessage()">Enviar</button>

<h3 style="padding-left:10px;">Chat Privado</h3>
<input type="text" id="privateUser" placeholder="@usuario">
<input type="text" id="privateMsg" placeholder="Mensagem privada">
<button onclick="sendPrivate()">Enviar Privado</button>
<div class="chat-box" id="privateBox"></div>
</div>

<!-- PERFIL -->
<div id="perfil" class="hidden">
<div class="settings" onclick="toggleSettings()">
<i data-lucide="settings"></i>
</div>

<div class="profile-card">
<div class="profile-img"></div>
<h2 id="profileUsername"></h2>
<p id="profileBio"></p>
<a id="profileLink" target="_blank"></a>
</div>

<div id="settingsMenu" class="hidden">
<button onclick="toggleDark()">Modo Escuro</button>
<h3>Editar Perfil</h3>
<input type="text" id="editName" placeholder="Nome">
<textarea id="editBio" maxlength="200" placeholder="Bio (200 caracteres)"></textarea>
<input type="text" id="editLink" placeholder="Link">
<button onclick="saveProfile()">Salvar</button>
</div>
</div>

<nav>
<button onclick="showTab('home')"><i data-lucide="home"></i></button>
<button onclick="showTab('comunidade')"><i data-lucide="message-circle"></i></button>
<button onclick="showTab('perfil')"><i data-lucide="user"></i></button>
</nav>

</div>

<script>
lucide.createIcons();

const firebaseConfig={
apiKey:"AIzaSyBdIH1kKv_e4f25nubgQ9ED8hyfl-3FmbM",
authDomain:"beamove-pro.firebaseapp.com",
projectId:"beamove-pro",
storageBucket:"beamove-pro.firebasestorage.app",
messagingSenderId:"816563837877",
appId:"1:816563837877:web:7d812c57fecc0338f117fc"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();

/* AUTH */
function register(){
let user=username.value.trim();
if(!user.startsWith("@")) return alert("Username deve começar com @");

db.collection("users").where("username","==",user).get()
.then(s=>{
if(!s.empty) return alert("Username já existe");

auth.createUserWithEmailAndPassword(registerEmail.value,registerPassword.value)
.then(c=>{
db.collection("users").doc(c.user.uid).set({
username:user,
bio:"",
link:""
});
showLogin();
});
});
}

function login(){
auth.signInWithEmailAndPassword(loginEmail.value,loginPassword.value);
}

function showRegister(){
loginScreen.classList.add("hidden");
registerScreen.classList.remove("hidden");
}

function showLogin(){
registerScreen.classList.add("hidden");
loginScreen.classList.remove("hidden");
}

auth.onAuthStateChanged(user=>{
if(user){
loginScreen.classList.add("hidden");
appScreen.classList.remove("hidden");
loadFeed();
loadChat();
loadProfile();
}
});

/* FEED */
function addPost(){
if(postInput.value==="") return;
db.collection("posts").add({
text:postInput.value,
user:auth.currentUser.uid,
created:new Date()
});
postInput.value="";
}

function loadFeed(){
db.collection("posts").orderBy("created","desc")
.onSnapshot(s=>{
feed.innerHTML="";
s.forEach(doc=>{
let d=doc.data();
let div=document.createElement("div");
div.className="post";
div.innerText=d.text;
feed.appendChild(div);
});
});
}

/* CHAT GLOBAL */
function formatDate(date){
let d=new Date(date);
return d.toLocaleDateString("pt-BR")+" "+d.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"});
}

function sendMessage(){
if(chatInput.value==="")return;
db.collection("chat").add({
text:chatInput.value,
user:auth.currentUser.uid,
created:new Date()
});
chatInput.value="";
}

function loadChat(){
db.collection("chat").orderBy("created")
.onSnapshot(async s=>{
chatBox.innerHTML="";
for(const doc of s.docs){
let data=doc.data();
let userDoc=await db.collection("users").doc(data.user).get();
let msg=document.createElement("div");
msg.className="message";
msg.innerHTML="<b>"+userDoc.data().username+"</b><br>"+data.text+
"<br><small>"+formatDate(data.created)+"</small>";
chatBox.appendChild(msg);
}
});
}

/* CHAT PRIVADO */
function sendPrivate(){
db.collection("users").where("username","==",privateUser.value).get()
.then(s=>{
if(s.empty) return alert("Usuário não encontrado");
let uid=s.docs[0].id;
db.collection("private").add({
from:auth.currentUser.uid,
to:uid,
text:privateMsg.value,
created:new Date()
});
privateMsg.value="";
});
}

db.collection("private").orderBy("created")
.onSnapshot(async s=>{
privateBox.innerHTML="";
for(const doc of s.docs){
let d=doc.data();
if(d.from===auth.currentUser.uid || d.to===auth.currentUser.uid){
let u=await db.collection("users").doc(d.from).get();
let div=document.createElement("div");
div.className="message";
div.innerHTML="<b>"+u.data().username+"</b>: "+d.text;
privateBox.appendChild(div);
}
}
});

/* PERFIL */
function loadProfile(){
db.collection("users").doc(auth.currentUser.uid).get()
.then(doc=>{
let d=doc.data();
profileUsername.innerText=d.username;
profileBio.innerText=d.bio;
profileLink.innerText=d.link;
profileLink.href=d.link;
});
}

function saveProfile(){
db.collection("users").doc(auth.currentUser.uid).update({
bio:editBio.value,
link:editLink.value
});
loadProfile();
}

function toggleSettings(){
settingsMenu.classList.toggle("hidden");
}

function toggleDark(){
document.body.classList.toggle("dark");
}

function showTab(tab){
home.classList.add("hidden");
comunidade.classList.add("hidden");
perfil.classList.add("hidden");
document.getElementById(tab).classList.remove("hidden");
}
</script>

</body>
</html>
