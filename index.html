<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
<title>BEAMOVE ‚Ä¢ Sua Jornada Fitness</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<!-- Icons -->
<script src="https://unpkg.com/lucide@latest"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

:root {
    --bg-primary: #f8fafc;
    --bg-secondary: #ffffff;
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --accent: #8b5cf6;
    --accent-light: #a78bfa;
    --accent-gradient: linear-gradient(135deg, #8b5cf6 0%, #c084fc 100%);
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
    --border: #e2e8f0;
    --card-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.1);
    --hover-shadow: 0 20px 60px -10px rgba(139, 92, 246, 0.3);
    --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    --unread-bg: rgba(139, 92, 246, 0.1);
    --unread-border: #8b5cf6;
    --seen-blue: #34b7f1;
}

.dark {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border: #334155;
    --card-shadow: 0 10px 40px -10px rgba(0, 0, 0, 0.5);
    --unread-bg: rgba(139, 92, 246, 0.2);
}

body {
    font-family: 'Inter', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    transition: var(--transition);
    line-height: 1.6;
}

/* Login/Register Styles */
.auth-container {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--accent-gradient);
    padding: 20px;
}

.auth-card {
    background: var(--bg-secondary);
    padding: 40px;
    border-radius: 30px;
    width: 100%;
    max-width: 400px;
    box-shadow: var(--card-shadow);
    animation: slideUp 0.5s ease;
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.auth-card h2 {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 10px;
    background: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.auth-card input {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border: 2px solid var(--border);
    border-radius: 15px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 16px;
    transition: var(--transition);
}

.auth-card input:focus {
    outline: none;
    border-color: var(--accent);
    box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.2);
}

.btn {
    width: 100%;
    padding: 15px;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    margin: 10px 0;
}

.btn-primary {
    background: var(--accent-gradient);
    color: white;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
}

.btn-secondary {
    background: var(--bg-primary);
    color: var(--text-primary);
    border: 2px solid var(--border);
}

.btn-secondary:hover {
    border-color: var(--accent);
    color: var(--accent);
}

/* Header */
header {
    background: var(--bg-secondary);
    padding: 15px 20px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    position: sticky;
    top: 0;
    z-index: 100;
    backdrop-filter: blur(10px);
    background: rgba(var(--bg-secondary-rgb), 0.8);
}

.header-content {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.logo {
    font-size: 28px;
    font-weight: 800;
    background: var(--accent-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    letter-spacing: -0.5px;
}

.header-actions {
    display: flex;
    gap: 15px;
}

.icon-btn {
    background: none;
    border: none;
    color: var(--text-primary);
    cursor: pointer;
    padding: 8px;
    border-radius: 12px;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
}

.icon-btn:hover {
    background: var(--bg-primary);
    color: var(--accent);
}

/* Cards de Produtos */
.products-section {
    max-width: 1200px;
    margin: 30px auto;
    padding: 0 20px;
}

.section-title {
    font-size: 24px;
    font-weight: 700;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.featured-card {
    background: var(--accent-gradient);
    border-radius: 30px;
    padding: 30px;
    color: white;
    margin-bottom: 30px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { box-shadow: 0 10px 40px -10px rgba(139, 92, 246, 0.3); }
    50% { box-shadow: 0 20px 60px -10px rgba(139, 92, 246, 0.6); }
    100% { box-shadow: 0 10px 40px -10px rgba(139, 92, 246, 0.3); }
}

.featured-card h3 {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 10px;
}

.featured-card p {
    opacity: 0.9;
    margin-bottom: 20px;
}

.featured-card .btn {
    width: auto;
    padding: 15px 40px;
    background: white;
    color: var(--accent);
    margin: 0;
}

.featured-card .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
}

.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
}

.product-card {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    box-shadow: var(--card-shadow);
    transition: var(--transition);
    cursor: pointer;
    position: relative;
    overflow: hidden;
}

.product-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: var(--accent-gradient);
    transform: scaleX(0);
    transition: var(--transition);
}

.product-card:hover::before {
    transform: scaleX(1);
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--hover-shadow);
}

.product-icon {
    width: 60px;
    height: 60px;
    background: var(--accent-gradient);
    border-radius: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 20px;
    color: white;
}

.product-card h4 {
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 10px;
}

.product-card p {
    color: var(--text-secondary);
    margin-bottom: 20px;
    font-size: 14px;
}

.product-price {
    font-size: 24px;
    font-weight: 700;
    color: var(--accent);
    margin-bottom: 15px;
}

.product-badge {
    position: absolute;
    top: 20px;
    right: 20px;
    background: var(--success);
    color: white;
    padding: 5px 15px;
    border-radius: 50px;
    font-size: 12px;
    font-weight: 600;
}

/* Feed de Conte√∫do */
.feed-container {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
}

.stories {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding: 10px 0;
    margin-bottom: 20px;
    scrollbar-width: none;
}

.stories::-webkit-scrollbar {
    display: none;
}

.story-item {
    min-width: 80px;
    text-align: center;
    cursor: pointer;
}

.story-circle {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 8px;
    border: 3px solid var(--bg-secondary);
    transition: var(--transition);
}

.story-item:hover .story-circle {
    transform: scale(1.05);
}

.story-circle span {
    color: white;
    font-weight: 600;
    font-size: 24px;
}

.story-label {
    font-size: 12px;
    font-weight: 500;
    color: var(--text-secondary);
}

.create-post {
    background: var(--bg-secondary);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--card-shadow);
}

.create-post textarea {
    width: 100%;
    padding: 15px;
    border: 2px solid var(--border);
    border-radius: 15px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 16px;
    resize: none;
    margin-bottom: 15px;
}

.post-card {
    background: var(--bg-secondary);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--card-shadow);
    animation: fadeIn 0.5s ease;
}

.post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.post-avatar {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 20px;
}

.post-info h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 4px;
}

.post-info span {
    font-size: 12px;
    color: var(--text-secondary);
}

.post-content {
    margin-bottom: 15px;
    line-height: 1.6;
}

.post-actions {
    display: flex;
    gap: 20px;
    border-top: 1px solid var(--border);
    padding-top: 15px;
}

.post-action {
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
}

.post-action:hover {
    color: var(--accent);
}

/* Chat */
.chat-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    display: grid;
    grid-template-columns: 350px 1fr;
    gap: 20px;
    height: calc(100vh - 140px);
    overflow: hidden;
}

.chat-sidebar {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 20px;
    box-shadow: var(--card-shadow);
    display: flex;
    flex-direction: column;
    height: 100%;
    overflow: hidden;
}

.chat-sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--border);
}

.chat-sidebar-header h3 {
    font-size: 18px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 8px;
}

.unread-total {
    background: var(--accent);
    color: white;
    font-size: 12px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 50px;
    margin-left: 8px;
}

.add-chat-btn {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: var(--accent-gradient);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.add-chat-btn:hover {
    transform: scale(1.1);
}

.chat-users {
    list-style: none;
    overflow-y: auto;
    flex: 1;
}

.chat-user {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: 15px;
    cursor: pointer;
    transition: var(--transition);
    margin-bottom: 5px;
    position: relative;
    border: 2px solid transparent;
}

.chat-user:hover {
    background: var(--bg-primary);
}

.chat-user.active {
    background: var(--accent);
    color: white;
}

.chat-user.unread {
    background: var(--unread-bg);
    border-color: var(--unread-border);
}

.chat-user-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 18px;
    flex-shrink: 0;
    position: relative;
}

.chat-user-info {
    flex: 1;
    overflow: hidden;
}

.chat-user-info strong {
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    font-size: 14px;
}

.chat-user-info span {
    font-size: 12px;
    display: block;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    opacity: 0.7;
}

.chat-user-time {
    font-size: 10px;
    opacity: 0.5;
    align-self: flex-start;
}

.unread-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: var(--accent);
    color: white;
    font-size: 10px;
    font-weight: 600;
    min-width: 18px;
    height: 18px;
    border-radius: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 4px;
    border: 2px solid var(--bg-secondary);
    z-index: 2;
}

.chat-main {
    background: var(--bg-secondary);
    border-radius: 25px;
    display: flex;
    flex-direction: column;
    box-shadow: var(--card-shadow);
    height: 100%;
    overflow: hidden;
}

.chat-header {
    padding: 15px 20px;
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--bg-secondary);
}

.back-to-users {
    display: none;
    background: none;
    border: none;
    color: var(--accent);
    cursor: pointer;
    margin-right: 5px;
    padding: 8px;
}

.chat-header-avatar {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 18px;
    position: relative;
}

.chat-header-info {
    flex: 1;
}

.chat-header-info h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 2px;
}

.chat-header-info p {
    font-size: 12px;
    color: var(--text-secondary);
}

.chat-messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    max-width: 70%;
}

.message.sent {
    align-self: flex-end;
    flex-direction: row-reverse;
}

.message-avatar {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 14px;
    font-weight: 600;
    flex-shrink: 0;
}

.message-content {
    background: var(--bg-primary);
    padding: 12px 15px;
    border-radius: 20px;
    position: relative;
    word-break: break-word;
}

.message.sent .message-content {
    background: var(--accent);
    color: white;
}

.message-content p {
    margin-bottom: 5px;
    padding-right: 20px;
}

.message-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 4px;
    margin-top: 2px;
}

.message-time {
    font-size: 10px;
    opacity: 0.7;
}

.message-status {
    display: flex;
    align-items: center;
    gap: 2px;
    font-size: 12px;
}

.message-status .sent {
    color: var(--text-secondary);
}

.message-status .delivered {
    color: var(--text-secondary);
}

.message-status .seen {
    color: var(--seen-blue);
}

.message-status i {
    font-size: 12px;
}

.message.unread-indicator {
    position: relative;
}

.message.unread-indicator::after {
    content: '‚óè';
    color: var(--accent);
    font-size: 10px;
    position: absolute;
    bottom: -12px;
    right: 10px;
}

.chat-input {
    padding: 20px;
    border-top: 1px solid var(--border);
    display: flex;
    gap: 10px;
    background: var(--bg-secondary);
}

.chat-input input {
    flex: 1;
    padding: 15px;
    border: 2px solid var(--border);
    border-radius: 25px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 16px;
    transition: var(--transition);
}

.chat-input input:focus {
    outline: none;
    border-color: var(--accent);
}

.chat-input button {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--accent-gradient);
    border: none;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.chat-input button:hover {
    transform: scale(1.1);
}

/* Modal de busca de usu√°rios */
.user-search-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    backdrop-filter: blur(5px);
}

.user-search-content {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    width: 90%;
    max-width: 400px;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: var(--card-shadow);
}

.user-search-content h3 {
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.close-modal-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 20px;
    padding: 5px;
}

.close-modal-btn:hover {
    color: var(--danger);
}

.user-search-input {
    width: 100%;
    padding: 12px 15px;
    border: 2px solid var(--border);
    border-radius: 15px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 14px;
    margin-bottom: 15px;
}

.user-search-input:focus {
    outline: none;
    border-color: var(--accent);
}

.user-search-list {
    list-style: none;
    max-height: 300px;
    overflow-y: auto;
}

.user-search-item {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px;
    border-radius: 12px;
    cursor: pointer;
    transition: var(--transition);
    border: 1px solid var(--border);
    margin-bottom: 8px;
}

.user-search-item:hover {
    background: var(--bg-primary);
    border-color: var(--accent);
}

.user-search-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    flex-shrink: 0;
}

.user-search-info {
    flex: 1;
}

.user-search-info strong {
    display: block;
    font-size: 14px;
}

.user-search-info span {
    font-size: 12px;
    color: var(--text-secondary);
}

.no-users-found {
    text-align: center;
    padding: 20px;
    color: var(--text-secondary);
}

/* Perfil */
.profile-container {
    max-width: 1000px;
    margin: 30px auto;
    padding: 0 20px;
}

.profile-header {
    background: var(--bg-secondary);
    border-radius: 30px;
    padding: 30px;
    box-shadow: var(--card-shadow);
    margin-bottom: 30px;
    position: relative;
}

.profile-top {
    display: flex;
    align-items: flex-start;
    gap: 30px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}

.profile-avatar-large {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: var(--accent-gradient);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 48px;
    font-weight: 700;
    border: 4px solid var(--bg-secondary);
    box-shadow: var(--card-shadow);
}

.profile-info-main {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.profile-username {
    font-size: 28px;
    font-weight: 600;
    margin-bottom: 8px;
}

.profile-name {
    font-size: 18px;
    font-weight: 500;
    color: var(--text-secondary);
    margin-bottom: 12px;
}

.profile-bio {
    font-size: 16px;
    line-height: 1.6;
    margin-bottom: 15px;
    max-width: 500px;
}

.profile-link {
    color: var(--accent);
    text-decoration: none;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 20px;
}

.profile-link:hover {
    text-decoration: underline;
}

.profile-stats {
    display: flex;
    gap: 40px;
    margin-bottom: 20px;
    justify-content: center;
}

.stat-item {
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: 700;
    color: var(--text-primary);
}

.stat-label {
    font-size: 14px;
    color: var(--text-secondary);
}

.profile-actions {
    display: flex;
    gap: 12px;
    margin-top: 20px;
    justify-content: center;
}

.profile-edit-btn {
    padding: 10px 24px;
    background: var(--accent-gradient);
    color: white;
    border: none;
    border-radius: 50px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 14px;
}

.profile-edit-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
}

.profile-settings-btn {
    width: 45px;
    height: 45px;
    border-radius: 50%;
    background: var(--bg-primary);
    border: 2px solid var(--border);
    color: var(--text-primary);
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
}

.profile-settings-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
    transform: rotate(90deg);
}

/* Ficha do Usu√°rio */
.user-card {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: var(--card-shadow);
    border: 1px solid var(--border);
}

.user-card h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
}

.user-card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
}

.user-card-item {
    background: var(--bg-primary);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid var(--border);
}

.user-card-label {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 5px;
    display: flex;
    align-items: center;
    gap: 5px;
}

.user-card-value {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
}

.user-card-value small {
    font-size: 12px;
    font-weight: 400;
    color: var(--text-secondary);
    margin-left: 5px;
}

.user-card-edit {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--border);
}

.user-card-edit-btn {
    background: none;
    border: 2px solid var(--border);
    padding: 12px;
    border-radius: 15px;
    width: 100%;
    color: var(--text-primary);
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.user-card-edit-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
}

/* Hist√≥rico de Progresso */
.progress-history {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: var(--card-shadow);
}

.progress-history h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
}

.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline::before {
    content: '';
    position: absolute;
    left: 0;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--accent-gradient);
}

.timeline-item {
    position: relative;
    padding-bottom: 25px;
}

.timeline-item::before {
    content: '';
    position: absolute;
    left: -34px;
    top: 0;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--accent);
    border: 2px solid var(--bg-secondary);
}

.timeline-date {
    font-size: 12px;
    color: var(--text-secondary);
    margin-bottom: 5px;
}

.timeline-content {
    background: var(--bg-primary);
    padding: 15px;
    border-radius: 15px;
    border: 1px solid var(--border);
}

.timeline-content p {
    margin-bottom: 5px;
}

.timeline-content strong {
    color: var(--accent);
}

/* Edit Forms */
.edit-section {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    margin-bottom: 30px;
    box-shadow: var(--card-shadow);
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.edit-section h4 {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
}

.edit-section input,
.edit-section textarea,
.edit-section select {
    width: 100%;
    padding: 12px 15px;
    margin: 8px 0;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 14px;
    transition: var(--transition);
}

.edit-section input:focus,
.edit-section textarea:focus,
.edit-section select:focus {
    outline: none;
    border-color: var(--accent);
}

.edit-section textarea {
    min-height: 80px;
    resize: vertical;
}

.edit-section-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
}

.edit-section-actions {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.edit-section .btn {
    width: auto;
    padding: 12px 24px;
    margin: 0;
}

/* DDI Select */
.ddi-select {
    display: flex;
    gap: 10px;
    align-items: center;
}

.ddi-select select {
    width: 100px;
    margin: 0;
}

.ddi-select input {
    flex: 1;
}

/* Posts do Perfil */
.profile-posts {
    background: var(--bg-secondary);
    border-radius: 25px;
    padding: 25px;
    box-shadow: var(--card-shadow);
}

.profile-posts h3 {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    color: var(--accent);
}

.posts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
}

.post-thumb {
    background: var(--bg-primary);
    border-radius: 15px;
    padding: 15px;
    border: 1px solid var(--border);
    cursor: pointer;
    transition: var(--transition);
}

.post-thumb:hover {
    transform: translateY(-2px);
    border-color: var(--accent);
}

.post-thumb p {
    font-size: 14px;
    margin-bottom: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.post-thumb-date {
    font-size: 10px;
    color: var(--text-secondary);
}

/* Navigation */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-secondary);
    padding: 10px 20px;
    display: flex;
    justify-content: space-around;
    align-items: center;
    box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.05);
    backdrop-filter: blur(10px);
    background: rgba(var(--bg-secondary-rgb), 0.95);
    z-index: 100;
    height: 70px;
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    color: var(--text-secondary);
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    padding: 8px 16px;
    border-radius: 50px;
    -webkit-tap-highlight-color: transparent;
}

.nav-item.active {
    color: var(--accent);
    background: var(--bg-primary);
}

.nav-item i {
    font-size: 24px;
}

.nav-item span {
    font-size: 11px;
    font-weight: 500;
}

.nav-badge {
    position: absolute;
    top: -2px;
    right: 5px;
    background: var(--danger);
    color: white;
    font-size: 9px;
    padding: 2px 5px;
    border-radius: 50px;
    min-width: 16px;
    text-align: center;
}

/* Forum Styles */
.forum-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.forum-title {
    font-size: 24px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.forum-add-btn {
    background: var(--accent-gradient);
    color: white;
    border: none;
    border-radius: 50px;
    padding: 12px 24px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
}

.forum-add-btn:hover {
    transform: translateY(-2px);
    box-shadow: var(--hover-shadow);
}

.forum-posts {
    margin-top: 20px;
}

.forum-post {
    background: var(--bg-secondary);
    border-radius: 20px;
    padding: 20px;
    margin-bottom: 20px;
    box-shadow: var(--card-shadow);
}

.forum-post-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 15px;
}

.forum-post-author {
    font-weight: 600;
}

.forum-post-date {
    font-size: 12px;
    color: var(--text-secondary);
}

.forum-post-content {
    margin-bottom: 15px;
    line-height: 1.6;
}

.forum-post-footer {
    display: flex;
    gap: 20px;
    border-top: 1px solid var(--border);
    padding-top: 15px;
}

.back-btn {
    background: none;
    border: none;
    color: var(--accent);
    font-weight: 600;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 20px;
    padding: 10px 0;
}

/* Utilit√°rios */
.hidden {
    display: none !important;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 20px;
    padding-bottom: 90px;
}

/* Ajuste para chat acima do menu */
#chat {
    height: calc(100vh - 80px);
    overflow: hidden;
    padding-bottom: 0;
}

/* Responsividade - CORRIGIDA */
@media (max-width: 768px) {
    .chat-container {
        grid-template-columns: 1fr;
        padding: 10px;
        height: calc(100vh - 140px);
    }
    
    .chat-sidebar {
        display: block !important;
        height: 100%;
        width: 100%;
    }
    
    .chat-sidebar.hidden-mobile {
        display: none !important;
    }
    
    .chat-main {
        display: none;
        height: 100%;
        width: 100%;
    }
    
    .chat-main.active {
        display: flex !important;
    }
    
    .back-to-users {
        display: block !important;
        padding: 10px;
        font-size: 20px;
    }
    
    .featured-card {
        flex-direction: column;
        text-align: center;
    }
    
    .featured-card .btn {
        width: 100%;
    }
    
    .profile-top {
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    
    .profile-stats {
        justify-content: center;
    }
    
    .profile-actions {
        justify-content: center;
    }
    
    .edit-section-row {
        grid-template-columns: 1fr;
    }
    
    .ddi-select {
        flex-direction: column;
    }
    
    .ddi-select select {
        width: 100%;
    }
    
    .message {
        max-width: 85%;
    }
    
    .bottom-nav {
        padding: 8px 15px;
        height: 65px;
    }
    
    .nav-item {
        padding: 6px 12px;
    }
    
    .container {
        padding-bottom: 80px;
    }
}

/* Para telas muito pequenas */
@media (max-width: 480px) {
    .chat-container {
        padding: 5px;
    }
    
    .chat-sidebar {
        padding: 15px;
    }
    
    .chat-user {
        padding: 10px;
    }
    
    .chat-user-avatar {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .message {
        max-width: 90%;
    }
    
    .message-avatar {
        width: 30px;
        height: 30px;
        font-size: 12px;
    }
}
</style>
</head>

<body>

<!-- Login Screen -->
<div id="loginScreen" class="auth-container">
    <div class="auth-card">
        <h2>BEAMOVE</h2>
        <p style="margin-bottom: 30px; color: var(--text-secondary);">Fa√ßa login para continuar</p>
        <input type="email" id="loginEmail" placeholder="Seu email">
        <input type="password" id="loginPassword" placeholder="Sua senha">
        <button class="btn btn-primary" onclick="login()">Entrar</button>
        <button class="btn btn-secondary" onclick="showRegister()">Criar nova conta</button>
    </div>
</div>

<!-- Register Screen -->
<div id="registerScreen" class="auth-container hidden">
    <div class="auth-card">
        <h2>Criar Conta</h2>
        <p style="margin-bottom: 30px; color: var(--text-secondary);">Comece sua jornada fitness</p>
        <input type="text" id="username" placeholder="@usuario">
        <input type="email" id="registerEmail" placeholder="Email">
        <input type="password" id="registerPassword" placeholder="Senha">
        <button class="btn btn-primary" onclick="register()">Cadastrar</button>
        <button class="btn btn-secondary" onclick="showLogin()">Voltar ao login</button>
    </div>
</div>

<!-- Main App -->
<div id="appScreen" class="hidden">
    <header>
        <div class="header-content">
            <div class="logo">BEAMOVE</div>
            <div class="header-actions">
                <button class="icon-btn" onclick="toggleDark()">
                    <i data-lucide="moon"></i>
                </button>
                <button class="icon-btn" onclick="logout()">
                    <i data-lucide="log-out"></i>
                    <span>Sair</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Home Section -->
    <div id="home" class="container">
        <!-- Stories (Instagram Style) -->
        <div class="stories">
            <div class="story-item" onclick="openForum('treino')">
                <div class="story-circle">
                    <span>üí™</span>
                </div>
                <span class="story-label">Treino</span>
            </div>
            <div class="story-item" onclick="openForum('receitas')">
                <div class="story-circle">
                    <span>ü•ó</span>
                </div>
                <span class="story-label">Receitas</span>
            </div>
            <div class="story-item" onclick="openForum('yoga')">
                <div class="story-circle">
                    <span>üßò</span>
                </div>
                <span class="story-label">Yoga</span>
            </div>
            <div class="story-item" onclick="openForum('dicas')">
                <div class="story-circle">
                    <span>üìö</span>
                </div>
                <span class="story-label">Dicas</span>
            </div>
        </div>

        <!-- Featured Product Card -->
        <div class="featured-card">
            <div>
                <h3>ü•ó Acompanhamento Nutricional</h3>
                <p>Planos personalizados com nutricionistas especializados</p>
                <div style="display: flex; gap: 15px;">
                    <button class="btn" onclick="window.open('https://hotmart.com', '_blank')">Comprar via Hotmart</button>
                    <button class="btn" onclick="window.open('https://kiwify.com', '_blank')">Comprar via Kiwify</button>
                </div>
            </div>
            <i data-lucide="apple" style="width: 80px; height: 80px; opacity: 0.5;"></i>
        </div>

        <!-- Products Grid -->
        <h2 class="section-title">
            <i data-lucide="package"></i>
            Nossos Produtos
        </h2>
        <div class="products-grid">
            <div class="product-card">
                <div class="product-badge">Novo</div>
                <div class="product-icon">
                    <i data-lucide="activity"></i>
                </div>
                <h4>Yoga para Iniciantes</h4>
                <p>Curso completo de yoga para todos os n√≠veis</p>
                <div class="product-price">‚Ç¨ 27,00</div>
                <button class="btn btn-primary" onclick="window.open('https://hotmart.com', '_blank')">Comprar</button>
            </div>

            <div class="product-card">
                <div class="product-icon">
                    <i data-lucide="flame"></i>
                </div>
                <h4>Emagrecimento Total</h4>
                <p>Programa completo para queima de gordura</p>
                <div class="product-price">‚Ç¨ 47,00</div>
                <button class="btn btn-primary" onclick="window.open('https://hotmart.com', '_blank')">Comprar</button>
            </div>

            <div class="product-card">
                <div class="product-icon">
                    <i data-lucide="book-open"></i>
                </div>
                <h4>E-books Fitness</h4>
                <p>Guias pr√°ticos para sua transforma√ß√£o</p>
                <div class="product-price">‚Ç¨ 17,00</div>
                <button class="btn btn-primary" onclick="window.open('https://kiwify.com', '_blank')">Comprar</button>
            </div>
        </div>

        <!-- Feed -->
        <div class="create-post">
            <textarea id="postInput" placeholder="Compartilhe sua evolu√ß√£o..."></textarea>
            <button class="btn btn-primary" onclick="addPost()">Publicar</button>
        </div>
        <div id="feed"></div>
    </div>

    <!-- Forum Section (Dynamic) -->
    <div id="forum" class="container hidden">
        <button class="back-btn" onclick="backToHome()">
            <i data-lucide="arrow-left"></i>
            Voltar
        </button>
        
        <div class="forum-header">
            <h2 class="forum-title" id="forumTitle">
                <i data-lucide="dumbbell" id="forumIcon"></i>
                <span id="forumName">Treino</span>
            </h2>
            <button class="forum-add-btn" onclick="showAddForumPost()">
                <i data-lucide="plus"></i>
                Adicionar
            </button>
        </div>

        <!-- Add Forum Post Form -->
        <div id="addForumPostForm" class="create-post hidden">
            <textarea id="forumPostInput" placeholder="Compartilhe sua dica..."></textarea>
            <button class="btn btn-primary" onclick="addForumPost()">Publicar</button>
            <button class="btn btn-secondary" onclick="hideAddForumPost()">Cancelar</button>
        </div>

        <!-- Forum Posts -->
        <div id="forumPosts" class="forum-posts"></div>
    </div>

    <!-- Chat Section -->
    <div id="chat" class="hidden">
        <div class="chat-container">
            <!-- Sidebar com lista de conversas -->
            <div class="chat-sidebar" id="chatSidebar">
                <div class="chat-sidebar-header">
                    <h3>
                        Mensagens
                        <span class="unread-total" id="unreadTotal">0</span>
                    </h3>
                    <button class="add-chat-btn" onclick="showUserSearchModal()">
                        <i data-lucide="plus"></i>
                    </button>
                </div>
                <ul class="chat-users" id="chatUsersList">
                    <li class="chat-user" data-chat-id="geral" data-user-id="geral" data-user-name="Geral" data-user-avatar="G" onclick="selectChat('geral', 'Geral', 'G', null)">
                        <div class="chat-user-avatar">G</div>
                        <div class="chat-user-info">
                            <strong>Geral</strong>
                            <span>Conversa com todos</span>
                        </div>
                    </li>
                </ul>
            </div>
            
            <!-- √Årea principal do chat -->
            <div class="chat-main" id="chatMain">
                <div class="chat-header" id="chatHeader">
                    <button class="back-to-users" onclick="backToUsersList()">
                        <i data-lucide="arrow-left"></i>
                    </button>
                    <div class="chat-header-avatar" id="chatHeaderAvatar">G</div>
                    <div class="chat-header-info">
                        <h4 id="chatHeaderName">Geral</h4>
                        <p id="chatHeaderStatus">Online</p>
                    </div>
                </div>
                <div class="chat-messages" id="chatBox"></div>
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Digite sua mensagem..." onkeypress="handleChatKeyPress(event)">
                    <button onclick="sendMessage()">
                        <i data-lucide="send"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de busca de usu√°rios -->
    <div id="userSearchModal" class="user-search-modal hidden">
        <div class="user-search-content">
            <h3>
                Nova mensagem
                <button class="close-modal-btn" onclick="hideUserSearchModal()">‚úï</button>
            </h3>
            <input type="text" id="userSearchInput" class="user-search-input" placeholder="Buscar @usuario..." onkeyup="searchUsers()">
            <ul class="user-search-list" id="userSearchList">
                <!-- Lista de usu√°rios ser√° inserida aqui -->
            </ul>
        </div>
    </div>

    <!-- Profile Section -->
    <div id="profile" class="hidden">
        <div class="profile-container">
            <div class="profile-header">
                <div class="profile-top">
                    <div class="profile-avatar-large" id="profileAvatar">U</div>
                    
                    <div class="profile-info-main">
                        <div class="profile-username">
                            <span id="profileUsername">@usuario</span>
                        </div>
                        
                        <div class="profile-name" id="profileDisplayName"></div>
                        
                        <div class="profile-bio" id="profileBio">
                            Ol√°, estou usando BEAMOVE! üí™
                        </div>
                        
                        <a id="profileLink" class="profile-link" href="#" target="_blank">
                            <i data-lucide="link"></i>
                            <span id="profileLinkText">Adicione seu link</span>
                        </a>
                        
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="profilePosts">0</div>
                                <div class="stat-label">posts</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="profileFollowers">0</div>
                                <div class="stat-label">seguidores</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="profileFollowing">0</div>
                                <div class="stat-label">seguindo</div>
                            </div>
                        </div>
                        
                        <div class="profile-actions">
                            <button class="profile-edit-btn" onclick="toggleEditProfile()">
                                <i data-lucide="edit-2" size="16"></i>
                                Editar perfil
                            </button>
                            <button class="profile-settings-btn" onclick="toggleSettings()" id="settingsBtn">
                                <i data-lucide="settings"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configura√ß√µes/Engrenagem -->
            <div id="settingsPanel" class="edit-section hidden">
                <h4>
                    <i data-lucide="settings"></i>
                    Configura√ß√µes do Perfil
                </h4>
                
                <div class="edit-section-row">
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">WhatsApp</label>
                        <div class="ddi-select">
                            <select id="whatsappDDI">
                                <option value="+351">+351 (Portugal)</option>
                                <option value="+44">+44 (Reino Unido)</option>
                                <option value="+34">+34 (Espanha)</option>
                                <option value="+33">+33 (Fran√ßa)</option>
                                <option value="+49">+49 (Alemanha)</option>
                                <option value="+39">+39 (It√°lia)</option>
                                <option value="+31">+31 (Holanda)</option>
                                <option value="+32">+32 (B√©lgica)</option>
                                <option value="+43">+43 (√Åustria)</option>
                                <option value="+46">+46 (Su√©cia)</option>
                                <option value="+47">+47 (Noruega)</option>
                                <option value="+45">+45 (Dinamarca)</option>
                                <option value="+358">+358 (Finl√¢ndia)</option>
                                <option value="+353">+353 (Irlanda)</option>
                                <option value="+41">+41 (Su√≠√ßa)</option>
                            </select>
                            <input type="tel" id="editWhatsApp" placeholder="N√∫mero">
                        </div>
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Telefone</label>
                        <div class="ddi-select">
                            <select id="phoneDDI">
                                <option value="+351">+351 (Portugal)</option>
                                <option value="+44">+44 (Reino Unido)</option>
                                <option value="+34">+34 (Espanha)</option>
                                <option value="+33">+33 (Fran√ßa)</option>
                                <option value="+49">+49 (Alemanha)</option>
                                <option value="+39">+39 (It√°lia)</option>
                                <option value="+31">+31 (Holanda)</option>
                                <option value="+32">+32 (B√©lgica)</option>
                                <option value="+43">+43 (√Åustria)</option>
                                <option value="+46">+46 (Su√©cia)</option>
                                <option value="+47">+47 (Noruega)</option>
                                <option value="+45">+45 (Dinamarca)</option>
                                <option value="+358">+358 (Finl√¢ndia)</option>
                                <option value="+353">+353 (Irlanda)</option>
                                <option value="+41">+41 (Su√≠√ßa)</option>
                            </select>
                            <input type="tel" id="editPhone" placeholder="N√∫mero">
                        </div>
                    </div>
                </div>
                
                <div class="edit-section-row">
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Data de Nascimento</label>
                        <input type="date" id="editBirthDate">
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">G√™nero</label>
                        <select id="editGender">
                            <option value="">Selecione</option>
                            <option value="masculino">Masculino</option>
                            <option value="feminino">Feminino</option>
                            <option value="outro">Outro</option>
                        </select>
                    </div>
                </div>
                
                <div class="edit-section-actions">
                    <button class="btn btn-primary" onclick="saveSettings()">Salvar configura√ß√µes</button>
                    <button class="btn btn-secondary" onclick="toggleSettings()">Cancelar</button>
                </div>
            </div>

            <!-- Ficha do Usu√°rio -->
            <div class="user-card">
                <h3>
                    <i data-lucide="clipboard-list"></i>
                    Minha Ficha Fitness
                </h3>
                
                <div class="user-card-grid" id="userCardGrid">
                    <!-- Preenchido via JavaScript -->
                </div>
                
                <div class="user-card-edit">
                    <button class="user-card-edit-btn" onclick="toggleUserCardForm()">
                        <i data-lucide="plus-circle"></i>
                        Adicionar/Atualizar dados
                    </button>
                </div>
            </div>

            <!-- Formul√°rio da Ficha do Usu√°rio -->
            <div id="userCardForm" class="edit-section hidden">
                <h4>
                    <i data-lucide="edit-3"></i>
                    Atualizar Ficha
                </h4>
                
                <div class="edit-section-row">
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Peso (kg)</label>
                        <input type="number" id="editWeight" step="0.1" placeholder="Ex: 75.5" oninput="calculateIMC()">
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Altura (cm)</label>
                        <input type="number" id="editHeight" placeholder="Ex: 175" oninput="calculateIMC()">
                    </div>
                </div>
                
                <div class="edit-section-row">
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">Idade</label>
                        <input type="number" id="editAge" placeholder="Ex: 30">
                    </div>
                    <div>
                        <label style="font-size: 12px; color: var(--text-secondary);">IMC</label>
                        <input type="text" id="editImc" readonly placeholder="Calculado automaticamente">
                    </div>
                </div>
                
                <div>
                    <label style="font-size: 12px; color: var(--text-secondary);">Objetivo</label>
                    <select id="editGoal">
                        <option value="">Selecione seu objetivo</option>
                        <option value="emagrecimento">Emagrecimento</option>
                        <option value="hipertrofia">Hipertrofia</option>
                        <option value="definicao">Defini√ß√£o muscular</option>
                        <option value="saude">Sa√∫de e bem-estar</option>
                        <option value="resistencia">Resist√™ncia</option>
                    </select>
                </div>
                
                <div>
                    <label style="font-size: 12px; color: var(--text-secondary);">Observa√ß√µes</label>
                    <textarea id="editNotes" placeholder="Les√µes, restri√ß√µes, etc..."></textarea>
                </div>
                
                <div class="edit-section-actions">
                    <button class="btn btn-primary" onclick="saveUserCard()">Salvar ficha</button>
                    <button class="btn btn-secondary" onclick="toggleUserCardForm()">Cancelar</button>
                </div>
            </div>

            <!-- Hist√≥rico de Progresso -->
            <div class="progress-history">
                <h3>
                    <i data-lucide="trending-up"></i>
                    Hist√≥rico de Progresso
                </h3>
                
                <div class="timeline" id="progressTimeline">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>

            <!-- Posts do Perfil -->
            <div class="profile-posts">
                <h3>
                    <i data-lucide="image"></i>
                    Meus Posts
                </h3>
                
                <div class="posts-grid" id="profilePostsGrid">
                    <!-- Preenchido via JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="nav-item active" onclick="showTab('home', event)">
            <i data-lucide="home"></i>
            <span>In√≠cio</span>
        </div>
        <div class="nav-item" onclick="showTab('chat', event)">
            <i data-lucide="message-circle"></i>
            <span>Chat</span>
        </div>
        <div class="nav-item" onclick="showTab('profile', event)">
            <i data-lucide="user"></i>
            <span>Perfil</span>
        </div>
    </nav>
</div>

<script>
// Initialize Lucide icons
lucide.createIcons();

// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyBdIH1kKv_e4f25nubgQ9ED8hyfl-3FmbM",
    authDomain: "beamove-pro.firebaseapp.com",
    projectId: "beamove-pro",
    storageBucket: "beamove-pro.firebasestorage.app",
    messagingSenderId: "816563837877",
    appId: "1:816563837877:web:7d812c57fecc0338f117fc"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Cache de usu√°rios para melhor performance
const userCache = new Map();

// Current forum category
let currentForum = 'treino';

// Chat state
let currentChat = 'geral';
let currentChatUser = null;
let currentChatUserName = 'Geral';
let currentChatUserAvatar = 'G';
let currentChatId = 'geral';
let allUsers = [];
let currentUserData = null;
let unsubscribeChat = null;

// Estados de mensagens n√£o lidas
let unreadMessages = new Map();
let lastReadTimestamps = new Map();
let messageStatus = new Map();

// Auth State Observer
auth.onAuthStateChanged(user => {
    if (user) {
        document.getElementById('loginScreen').classList.add('hidden');
        document.getElementById('registerScreen').classList.add('hidden');
        document.getElementById('appScreen').classList.remove('hidden');
        
        // Carregar dados do usu√°rio atual
        db.collection('users').doc(user.uid).get().then(doc => {
            currentUserData = doc.data();
            userCache.set(user.uid, currentUserData);
        });
        
        loadFeed();
        loadProfile();
        loadProfilePosts();
        loadUserCard();
        loadProgressHistory();
        loadAllUsers();
        loadChatList();
        
        // Restaurar √∫ltima conversa
        const lastChat = localStorage.getItem('lastChat');
        if (lastChat) {
            const chatData = JSON.parse(lastChat);
            setTimeout(() => {
                selectChat(chatData.chatId, chatData.userName, chatData.userAvatar, chatData.userId);
            }, 500);
        } else {
            selectChat('geral', 'Geral', 'G', null);
        }
        
        console.log('Usu√°rio logado:', user.uid);
    } else {
        document.getElementById('loginScreen').classList.remove('hidden');
        document.getElementById('appScreen').classList.add('hidden');
    }
});

// Register
function register() {
    const username = document.getElementById('username').value.trim();
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    if (!username) {
        alert('Por favor, preencha o nome de usu√°rio');
        return;
    }
    
    if (!username.startsWith('@')) {
        alert('Username deve come√ßar com @');
        return;
    }
    
    if (!email || !password) {
        alert('Por favor, preencha todos os campos');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerText;
    btn.innerText = 'Cadastrando...';
    btn.disabled = true;
    
    db.collection('users').where('username', '==', username).get()
        .then(snapshot => {
            if (!snapshot.empty) {
                throw new Error('Username j√° existe');
            }
            
            return auth.createUserWithEmailAndPassword(email, password);
        })
        .then(userCredential => {
            return db.collection('users').doc(userCredential.user.uid).set({
                username: username,
                email: email,
                bio: '',
                link: '',
                name: username,
                displayName: '',
                whatsapp: '',
                whatsappDDI: '+351',
                phone: '',
                phoneDDI: '+351',
                birthDate: '',
                gender: '',
                createdAt: new Date()
            }).then(() => {
                return userCredential;
            }).catch(error => {
                if (error.code === 'permission-denied') {
                    userCredential.user.delete().catch(() => {});
                    throw new Error('Erro de permiss√£o no Firestore. Verifique as regras do banco de dados.');
                }
                throw error;
            });
        })
        .then(userCredential => {
            alert('Conta criada com sucesso!');
            showLogin();
        })
        .catch(error => {
            btn.innerText = originalText;
            btn.disabled = false;
            
            if (error.message === 'Username j√° existe') {
                alert('Este nome de usu√°rio j√° est√° em uso');
            } else if (error.code === 'auth/email-already-in-use') {
                alert('Este email j√° est√° sendo usado');
            } else if (error.code === 'auth/weak-password') {
                alert('A senha deve ter pelo menos 6 caracteres');
            } else if (error.code === 'auth/invalid-email') {
                alert('Email inv√°lido');
            } else if (error.message.includes('permiss√£o')) {
                alert('Erro de permiss√£o no banco de dados.');
                console.error('Erro de permiss√£o:', error);
            } else {
                alert('Erro ao criar conta: ' + (error.message || error));
                console.error('Erro completo:', error);
            }
        });
}

// Login
function login() {
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    auth.signInWithEmailAndPassword(email, password)
        .catch(error => {
            alert(error.message);
        });
}

// Logout
function logout() {
    auth.signOut();
}

// Show Register Screen
function showRegister() {
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('registerScreen').classList.remove('hidden');
}

// Show Login Screen
function showLogin() {
    document.getElementById('registerScreen').classList.add('hidden');
    document.getElementById('loginScreen').classList.remove('hidden');
}

// Toggle Dark Mode
function toggleDark() {
    document.body.classList.toggle('dark');
    lucide.createIcons();
}

// Show Tab - CORRIGIDO para mobile
function showTab(tabName, e) {
    if (e) {
        e.preventDefault();
    }
    
    document.getElementById('home').classList.add('hidden');
    document.getElementById('chat').classList.add('hidden');
    document.getElementById('profile').classList.add('hidden');
    document.getElementById('forum').classList.add('hidden');
    
    document.getElementById(tabName).classList.remove('hidden');
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    // Encontrar e ativar o item clicado
    if (e && e.currentTarget) {
        e.currentTarget.classList.add('active');
    } else {
        // Fallback para quando n√£o tem evento
        document.querySelectorAll('.nav-item').forEach(item => {
            if (item.querySelector('span').innerText.toLowerCase() === tabName) {
                item.classList.add('active');
            }
        });
    }
    
    if (tabName === 'profile') {
        loadProfile();
        loadProfilePosts();
        loadUserCard();
        loadProgressHistory();
    }
    
    if (tabName === 'chat') {
        // Reset para a tela principal de chats
        const lastChat = localStorage.getItem('lastChat');
        if (lastChat) {
            const chatData = JSON.parse(lastChat);
            selectChat(chatData.chatId, chatData.userName, chatData.userAvatar, chatData.userId);
        } else {
            selectChat('geral', 'Geral', 'G', null);
        }
    }
    
    lucide.createIcons();
}

// Open Forum
function openForum(category) {
    currentForum = category;
    
    const titles = {
        'treino': { name: 'Treino', icon: 'dumbbell' },
        'receitas': { name: 'Receitas', icon: 'utensils' },
        'yoga': { name: 'Yoga', icon: 'activity' },
        'dicas': { name: 'Dicas', icon: 'book-open' }
    };
    
    document.getElementById('forumName').innerText = titles[category].name;
    document.getElementById('forumIcon').setAttribute('data-lucide', titles[category].icon);
    
    document.getElementById('home').classList.add('hidden');
    document.getElementById('forum').classList.remove('hidden');
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    
    loadForumPosts();
    lucide.createIcons();
}

// Back to Home
function backToHome() {
    document.getElementById('forum').classList.add('hidden');
    document.getElementById('home').classList.remove('hidden');
    
    document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
    });
    document.querySelector('.nav-item:first-child').classList.add('active');
    
    lucide.createIcons();
}

// Show Add Forum Post Form
function showAddForumPost() {
    document.getElementById('addForumPostForm').classList.remove('hidden');
}

// Hide Add Forum Post Form
function hideAddForumPost() {
    document.getElementById('addForumPostForm').classList.add('hidden');
    document.getElementById('forumPostInput').value = '';
}

// Add Forum Post
function addForumPost() {
    const postInput = document.getElementById('forumPostInput');
    const postText = postInput.value.trim();
    
    if (!postText) {
        alert('Por favor, digite algo para publicar');
        return;
    }
    
    if (!auth.currentUser) {
        alert('Voc√™ precisa estar logado');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerText;
    btn.innerText = 'Publicando...';
    btn.disabled = true;
    
    const postData = {
        text: postText,
        userId: auth.currentUser.uid,
        user: auth.currentUser.uid,
        category: currentForum,
        created: new Date(),
        likes: 0,
        comments: 0
    };
    
    db.collection('forum_posts').add(postData)
    .then((docRef) => {
        console.log('Post criado com sucesso! ID:', docRef.id);
        
        postInput.value = '';
        hideAddForumPost();
        alert('Post publicado com sucesso!');
        loadForumPostsSimple();
    })
    .catch(error => {
        console.error('ERRO ao publicar:', error);
        alert('Erro ao publicar: ' + error.message);
    })
    .finally(() => {
        btn.innerText = originalText;
        btn.disabled = false;
    });
}

// Load Forum Posts
function loadForumPostsSimple() {
    if (!auth.currentUser) {
        console.log('Usu√°rio n√£o logado, n√£o carregando posts');
        return;
    }
    
    console.log('Carregando posts para categoria:', currentForum);
    
    const forumPosts = document.getElementById('forumPosts');
    forumPosts.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Carregando posts...</div>';
    
    db.collection('forum_posts')
        .where('category', '==', currentForum)
        .get()
        .then(async (querySnapshot) => {
            console.log('Posts encontrados:', querySnapshot.size);
            
            if (querySnapshot.empty) {
                forumPosts.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum post ainda. Seja o primeiro a compartilhar! üìù</div>';
                return;
            }
            
            const postsArray = [];
            
            for (const doc of querySnapshot.docs) {
                const post = doc.data();
                const postId = doc.id;
                
                try {
                    let userData = userCache.get(post.user);
                    if (!userData) {
                        const userDoc = await db.collection('users').doc(post.user).get();
                        userData = userDoc.data();
                        userCache.set(post.user, userData);
                    }
                    let username = userData?.username || '@usuario';
                    
                    postsArray.push({
                        postId,
                        post,
                        username
                    });
                } catch (error) {
                    console.error('Erro ao buscar usu√°rio:', error);
                    postsArray.push({
                        postId,
                        post,
                        username: '@usuario'
                    });
                }
            }
            
            postsArray.sort((a, b) => {
                const dateA = a.post.created ? new Date(a.post.created.seconds * 1000) : new Date(0);
                const dateB = b.post.created ? new Date(b.post.created.seconds * 1000) : new Date(0);
                return dateB - dateA;
            });
            
            forumPosts.innerHTML = '';
            
            postsArray.forEach(item => {
                const postElement = document.createElement('div');
                postElement.className = 'forum-post';
                postElement.innerHTML = `
                    <div class="forum-post-header">
                        <div class="post-avatar">${item.username ? item.username.charAt(1).toUpperCase() : 'U'}</div>
                        <div>
                            <div class="forum-post-author">${item.username}</div>
                            <div class="forum-post-date">${formatDate(item.post.created)}</div>
                        </div>
                    </div>
                    <div class="forum-post-content">${item.post.text}</div>
                    <div class="forum-post-footer">
                        <div class="post-action" onclick="likeForumPost('${item.postId}')">
                            <i data-lucide="heart"></i>
                            <span>${item.post.likes || 0}</span>
                        </div>
                        <div class="post-action" onclick="commentForumPost('${item.postId}')">
                            <i data-lucide="message-circle"></i>
                            <span>${item.post.comments || 0}</span>
                        </div>
                    </div>
                `;
                forumPosts.appendChild(postElement);
            });
            
            lucide.createIcons();
        })
        .catch(error => {
            console.error('ERRO ao carregar posts:', error);
            forumPosts.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">Erro ao carregar posts. Verifique o console (F12)</div>';
        });
}

function loadForumPosts() {
    loadForumPostsSimple();
}

// Like Forum Post
function likeForumPost(postId) {
    const postRef = db.collection('forum_posts').doc(postId);
    
    postRef.get().then(doc => {
        if (doc.exists) {
            const likes = (doc.data().likes || 0) + 1;
            postRef.update({ likes: likes });
        }
    }).catch(error => {
        console.error('Erro ao dar like:', error);
    });
}

// Comment Forum Post
function commentForumPost(postId) {
    alert('Funcionalidade de coment√°rios em breve!');
}

// Load Feed
function loadFeed() {
    db.collection('posts').orderBy('created', 'desc')
        .onSnapshot(snapshot => {
            const feed = document.getElementById('feed');
            feed.innerHTML = '';
            
            if (snapshot.empty) {
                feed.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhum post no feed ainda. Compartilhe algo! üì±</div>';
                return;
            }
            
            snapshot.forEach(async doc => {
                const post = doc.data();
                try {
                    let userData = userCache.get(post.user);
                    if (!userData) {
                        const userDoc = await db.collection('users').doc(post.user).get();
                        userData = userDoc.data();
                        userCache.set(post.user, userData);
                    }
                    
                    const postElement = document.createElement('div');
                    postElement.className = 'post-card';
                    postElement.innerHTML = `
                        <div class="post-header">
                            <div class="post-avatar">${userData?.username ? userData.username.charAt(1).toUpperCase() : 'U'}</div>
                            <div class="post-info">
                                <h4>${userData?.username || '@usuario'}</h4>
                                <span>${formatDate(post.created)}</span>
                            </div>
                        </div>
                        <div class="post-content">${post.text}</div>
                        <div class="post-actions">
                            <div class="post-action" onclick="likePost('${doc.id}')">
                                <i data-lucide="heart"></i>
                                <span>${post.likes || 0}</span>
                            </div>
                            <div class="post-action" onclick="commentPost('${doc.id}')">
                                <i data-lucide="message-circle"></i>
                                <span>${post.comments || 0}</span>
                            </div>
                            <div class="post-action" onclick="sharePost('${doc.id}')">
                                <i data-lucide="share-2"></i>
                            </div>
                        </div>
                    `;
                    feed.appendChild(postElement);
                } catch (error) {
                    console.error('Erro ao carregar post do feed:', error);
                }
            });
            
            lucide.createIcons();
        });
}

// Add Post
function addPost() {
    const postInput = document.getElementById('postInput');
    const postText = postInput.value.trim();
    
    if (!postText) {
        alert('Por favor, digite algo para publicar');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerText;
    btn.innerText = 'Publicando...';
    btn.disabled = true;
    
    db.collection('posts').add({
        text: postText,
        user: auth.currentUser.uid,
        created: new Date(),
        likes: 0,
        comments: 0
    })
    .then(() => {
        postInput.value = '';
        alert('Post publicado com sucesso!');
    })
    .catch(error => {
        console.error('Erro ao publicar:', error);
        alert('Erro ao publicar: ' + error.message);
    })
    .finally(() => {
        btn.innerText = originalText;
        btn.disabled = false;
    });
}

// Load Chat List
function loadChatList() {
    const user = auth.currentUser;
    if (!user) return;
    
    const usersList = document.getElementById('chatUsersList');
    
    const geralItem = document.createElement('li');
    geralItem.className = 'chat-user';
    geralItem.setAttribute('data-chat-id', 'geral');
    geralItem.setAttribute('data-user-id', 'geral');
    geralItem.setAttribute('data-user-name', 'Geral');
    geralItem.setAttribute('data-user-avatar', 'G');
    geralItem.onclick = function() { selectChat('geral', 'Geral', 'G', null); };
    geralItem.innerHTML = `
        <div class="chat-user-avatar">G</div>
        <div class="chat-user-info">
            <strong>Geral</strong>
            <span>Conversa com todos</span>
        </div>
    `;
    
    usersList.innerHTML = '';
    usersList.appendChild(geralItem);
    
    db.collection('private_chats')
        .where('participants', 'array-contains', user.uid)
        .get()
        .then(snapshot => {
            const chatUsers = new Map();
            
            snapshot.forEach(doc => {
                const chat = doc.data();
                const otherUserId = chat.participants.find(id => id !== user.uid);
                
                if (otherUserId) {
                    const existing = chatUsers.get(otherUserId);
                    if (!existing || (chat.created && existing.created < chat.created)) {
                        chatUsers.set(otherUserId, {
                            lastMessage: chat.text,
                            lastMessageTime: chat.created
                        });
                    }
                }
            });
            
            chatUsers.forEach((chatInfo, userId) => {
                db.collection('users').doc(userId).get().then(userDoc => {
                    if (userDoc.exists) {
                        const userData = userDoc.data();
                        userCache.set(userId, userData);
                        const unreadCount = unreadMessages.get(userId) || 0;
                        
                        const chatItem = document.createElement('li');
                        chatItem.className = `chat-user ${unreadCount > 0 ? 'unread' : ''}`;
                        chatItem.setAttribute('data-chat-id', `private_${userId}`);
                        chatItem.setAttribute('data-user-id', userId);
                        chatItem.setAttribute('data-user-name', userData.username);
                        chatItem.setAttribute('data-user-avatar', userData.username.charAt(1).toUpperCase());
                        chatItem.onclick = function() { selectChat(`private_${userId}`, userData.username, userData.username.charAt(1).toUpperCase(), userId); };
                        
                        let unreadBadge = '';
                        if (unreadCount > 0) {
                            unreadBadge = `<span class="unread-badge">${unreadCount}</span>`;
                        }
                        
                        chatItem.innerHTML = `
                            <div class="chat-user-avatar">
                                ${userData.username.charAt(1).toUpperCase()}
                                ${unreadBadge}
                            </div>
                            <div class="chat-user-info">
                                <strong>${userData.username}</strong>
                                <span>${chatInfo.lastMessage || 'Clique para conversar'}</span>
                            </div>
                            <div class="chat-user-time">${formatTime(chatInfo.lastMessageTime)}</div>
                        `;
                        usersList.appendChild(chatItem);
                    }
                });
            });
        })
        .catch(error => {
            console.error('Erro ao carregar lista de chats:', error);
        });
}

// Load Chat Messages
function loadChat(chatId, otherUserId = null) {
    if (unsubscribeChat) {
        unsubscribeChat();
    }
    
    const chatBox = document.getElementById('chatBox');
    chatBox.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Carregando mensagens...</div>';
    
    const user = auth.currentUser;
    
    if (chatId === 'geral') {
        unsubscribeChat = db.collection('chat')
            .orderBy('created')
            .onSnapshot(snapshot => {
                chatBox.innerHTML = '';
                
                if (snapshot.empty) {
                    chatBox.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma mensagem ainda. Envie a primeira! üí¨</div>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const message = doc.data();
                    displayMessage(message);
                });
                
                chatBox.scrollTop = chatBox.scrollHeight;
            }, error => {
                console.error('Erro ao carregar chat geral:', error);
                chatBox.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">Erro ao carregar mensagens</div>';
            });
    } else {
        unsubscribeChat = db.collection('private_chats')
            .where('participants', 'array-contains', user.uid)
            .onSnapshot(snapshot => {
                const messages = [];
                let newUnreadCount = 0;
                
                snapshot.forEach(doc => {
                    const message = doc.data();
                    
                    if (message.participants && 
                        message.participants.length === 2 && 
                        message.participants.includes(otherUserId) && 
                        message.participants.includes(user.uid)) {
                        
                        messages.push({
                            ...message,
                            id: doc.id
                        });
                        
                        if (message.user !== user.uid) {
                            const lastRead = lastReadTimestamps.get(otherUserId) || 0;
                            const messageTime = message.created ? new Date(message.created.seconds * 1000).getTime() : 0;
                            
                            if (messageTime > lastRead) {
                                newUnreadCount++;
                            }
                            
                            if (!message.delivered) {
                                doc.ref.update({ delivered: true, deliveredAt: new Date() });
                            }
                            
                            if (chatId === currentChatId && message.user !== user.uid) {
                                doc.ref.update({ seen: true, seenAt: new Date() });
                            }
                        }
                    }
                });
                
                if (chatId === currentChatId && otherUserId) {
                    unreadMessages.set(otherUserId, newUnreadCount);
                    updateUnreadBadges();
                }
                
                messages.sort((a, b) => {
                    const dateA = a.created ? new Date(a.created.seconds * 1000) : new Date(0);
                    const dateB = b.created ? new Date(b.created.seconds * 1000) : new Date(0);
                    return dateA - dateB;
                });
                
                chatBox.innerHTML = '';
                
                if (messages.length === 0) {
                    chatBox.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--text-secondary);">Nenhuma mensagem ainda. Envie a primeira! üí¨</div>';
                } else {
                    messages.forEach(message => {
                        displayMessage(message);
                    });
                }
                
                chatBox.scrollTop = chatBox.scrollHeight;
            }, error => {
                console.error('Erro ao carregar chat privado:', error);
                chatBox.innerHTML = '<div style="text-align: center; padding: 40px; color: var(--danger);">Erro ao carregar mensagens</div>';
            });
    }
}

// Display a message in the chat
async function displayMessage(message) {
    try {
        let userData = userCache.get(message.user);
        if (!userData) {
            const userDoc = await db.collection('users').doc(message.user).get();
            userData = userDoc.data();
            userCache.set(message.user, userData);
        }
        
        const messageElement = document.createElement('div');
        messageElement.className = message.user === auth.currentUser.uid ? 'message sent' : 'message';
        
        const messageTime = message.created ? new Date(message.created.seconds * 1000) : new Date();
        const timeString = messageTime.toLocaleTimeString('pt-BR', { 
            hour: '2-digit', 
            minute: '2-digit',
            hour12: false 
        });
        
        let statusHtml = '';
        if (message.user === auth.currentUser.uid) {
            if (message.seen) {
                statusHtml = '<span class="message-status"><i data-lucide="check-check" class="seen" style="color: var(--seen-blue); width: 14px; height: 14px;"></i></span>';
            } else if (message.delivered) {
                statusHtml = '<span class="message-status"><i data-lucide="check-check" style="width: 14px; height: 14px;"></i></span>';
            } else {
                statusHtml = '<span class="message-status"><i data-lucide="check" style="width: 14px; height: 14px;"></i></span>';
            }
        }
        
        messageElement.innerHTML = `
            <div class="message-avatar">${userData?.username ? userData.username.charAt(1).toUpperCase() : 'U'}</div>
            <div class="message-content">
                <p>${message.text}</p>
                <div class="message-footer">
                    <span class="message-time">${timeString}</span>
                    ${statusHtml}
                </div>
            </div>
        `;
        document.getElementById('chatBox').appendChild(messageElement);
        lucide.createIcons();
    } catch (error) {
        console.error('Erro ao exibir mensagem:', error);
    }
}

// Select Chat
function selectChat(chatId, userName, userAvatar, userId = null) {
    currentChat = chatId;
    currentChatUser = userId;
    currentChatUserName = userName;
    currentChatUserAvatar = userAvatar;
    currentChatId = chatId;
    
    if (userId) {
        markAsRead(userId);
    }
    
    localStorage.setItem('lastChat', JSON.stringify({
        chatId: chatId,
        userName: userName,
        userAvatar: userAvatar,
        userId: userId
    }));
    
    document.getElementById('chatHeaderName').innerText = userName;
    document.getElementById('chatHeaderAvatar').innerText = userAvatar;
    
    // CORRE√á√ÉO: Verifica√ß√£o de mobile mais robusta
    if (window.innerWidth <= 768) {
        document.getElementById('chatSidebar').classList.add('hidden-mobile');
        document.getElementById('chatMain').classList.add('active');
    }
    
    document.querySelectorAll('.chat-user').forEach(item => {
        item.classList.remove('active');
        if (chatId === 'geral' && item.getAttribute('data-chat-id') === 'geral') {
            item.classList.add('active');
        } else if (item.getAttribute('data-user-id') === userId) {
            item.classList.add('active');
            item.classList.remove('unread');
        }
    });
    
    loadChat(chatId, userId);
}

function markAsRead(userId) {
    if (!userId) return;
    
    const now = Date.now();
    lastReadTimestamps.set(userId, now);
    unreadMessages.set(userId, 0);
    
    const readData = JSON.parse(localStorage.getItem('readTimestamps') || '{}');
    readData[userId] = now;
    localStorage.setItem('readTimestamps', JSON.stringify(readData));
    
    updateUnreadBadges();
}

function updateUnreadBadges() {
    const usersList = document.getElementById('chatUsersList');
    const unreadTotal = document.getElementById('unreadTotal');
    
    let totalUnread = 0;
    
    unreadMessages.forEach((count, userId) => {
        totalUnread += count;
        
        const userItem = usersList.querySelector(`[data-user-id="${userId}"]`);
        if (userItem) {
            if (count > 0) {
                userItem.classList.add('unread');
                
                let badge = userItem.querySelector('.unread-badge');
                if (!badge) {
                    badge = document.createElement('span');
                    badge.className = 'unread-badge';
                    userItem.querySelector('.chat-user-avatar').appendChild(badge);
                }
                badge.textContent = count;
            } else {
                userItem.classList.remove('unread');
                const badge = userItem.querySelector('.unread-badge');
                if (badge) badge.remove();
            }
        }
    });
    
    unreadTotal.textContent = totalUnread;
    unreadTotal.style.display = totalUnread > 0 ? 'inline' : 'none';
}

// CORRE√á√ÉO: Fun√ß√£o backToUsersList melhorada
function backToUsersList() {
    document.getElementById('chatSidebar').classList.remove('hidden-mobile');
    document.getElementById('chatMain').classList.remove('active');
}

// Send Message
function sendMessage() {
    const chatInput = document.getElementById('chatInput');
    const messageText = chatInput.value.trim();
    
    if (!messageText) return;
    
    const user = auth.currentUser;
    
    if (currentChat === 'geral') {
        db.collection('chat').add({
            text: messageText,
            user: user.uid,
            created: new Date(),
            delivered: false,
            seen: false
        })
        .then(() => {
            chatInput.value = '';
        })
        .catch(error => {
            console.error('Erro ao enviar mensagem:', error);
            alert('Erro ao enviar mensagem: ' + error.message);
        });
    } else {
        const chatData = {
            text: messageText,
            user: user.uid,
            participants: [user.uid, currentChatUser].sort(),
            created: new Date(),
            delivered: false,
            seen: false
        };
        
        db.collection('private_chats').add(chatData)
            .then(() => {
                chatInput.value = '';
                
                const usersList = document.getElementById('chatUsersList');
                const userItem = usersList.querySelector(`[data-user-id="${currentChatUser}"]`);
                if (userItem) {
                    const lastMessageSpan = userItem.querySelector('.chat-user-info span');
                    if (lastMessageSpan) {
                        lastMessageSpan.textContent = messageText;
                    }
                }
            })
            .catch(error => {
                console.error('Erro ao enviar mensagem privada:', error);
                alert('Erro ao enviar mensagem: ' + error.message);
            });
    }
}

function handleChatKeyPress(e) {
    if (e.key === 'Enter') {
        e.preventDefault();
        sendMessage();
    }
}

// Load All Users for Search
function loadAllUsers() {
    db.collection('users').get()
        .then(snapshot => {
            allUsers = [];
            snapshot.forEach(doc => {
                if (doc.id !== auth.currentUser.uid) {
                    const userData = doc.data();
                    userCache.set(doc.id, userData);
                    allUsers.push({
                        id: doc.id,
                        ...userData
                    });
                }
            });
        })
        .catch(error => {
            console.error('Erro ao carregar usu√°rios:', error);
        });
}

function showUserSearchModal() {
    document.getElementById('userSearchModal').classList.remove('hidden');
    document.getElementById('userSearchInput').value = '';
    document.getElementById('userSearchInput').focus();
    searchUsers();
}

function hideUserSearchModal() {
    document.getElementById('userSearchModal').classList.add('hidden');
}

function searchUsers() {
    const searchTerm = document.getElementById('userSearchInput').value.toLowerCase();
    const searchList = document.getElementById('userSearchList');
    
    const filteredUsers = allUsers.filter(user => 
        user.username.toLowerCase().includes(searchTerm)
    );
    
    if (filteredUsers.length === 0) {
        searchList.innerHTML = '<li class="no-users-found">Nenhum usu√°rio encontrado</li>';
        return;
    }
    
    searchList.innerHTML = '';
    filteredUsers.forEach(user => {
        const li = document.createElement('li');
        li.className = 'user-search-item';
        li.onclick = function() {
            hideUserSearchModal();
            const chatId = `private_${user.id}`;
            selectChat(chatId, user.username, user.username.charAt(1).toUpperCase(), user.id);
        };
        li.innerHTML = `
            <div class="user-search-avatar">${user.username.charAt(1).toUpperCase()}</div>
            <div class="user-search-info">
                <strong>${user.username}</strong>
                <span>${user.displayName || 'Membro'}</span>
            </div>
        `;
        searchList.appendChild(li);
    });
}

// Load Profile
function loadProfile() {
    const user = auth.currentUser;
    
    db.collection('users').doc(user.uid).get()
        .then(doc => {
            const data = doc.data();
            userCache.set(user.uid, data);
            document.getElementById('profileUsername').innerText = data.username || '@usuario';
            document.getElementById('profileDisplayName').innerText = data.displayName || '';
            document.getElementById('profileBio').innerText = data.bio || 'Ol√°, estou usando BEAMOVE! üí™';
            document.getElementById('profileLinkText').innerText = data.link || 'Adicione seu link';
            document.getElementById('profileLink').href = data.link || '#';
            document.getElementById('profileAvatar').innerText = data.username ? data.username.charAt(1).toUpperCase() : 'U';
            
            const editName = document.getElementById('editName');
            if (editName) editName.value = data.displayName || '';
            
            const editBio = document.getElementById('editBio');
            if (editBio) editBio.value = data.bio || '';
            
            const editLink = document.getElementById('editLink');
            if (editLink) editLink.value = data.link || '';
            
            const whatsappDDI = document.getElementById('whatsappDDI');
            if (whatsappDDI) whatsappDDI.value = data.whatsappDDI || '+351';
            
            const editWhatsApp = document.getElementById('editWhatsApp');
            if (editWhatsApp) editWhatsApp.value = data.whatsapp || '';
            
            const phoneDDI = document.getElementById('phoneDDI');
            if (phoneDDI) phoneDDI.value = data.phoneDDI || '+351';
            
            const editPhone = document.getElementById('editPhone');
            if (editPhone) editPhone.value = data.phone || '';
            
            const editBirthDate = document.getElementById('editBirthDate');
            if (editBirthDate) editBirthDate.value = data.birthDate || '';
            
            const editGender = document.getElementById('editGender');
            if (editGender) editGender.value = data.gender || '';
            
            loadProfileStats();
        })
        .catch(error => {
            console.error('Erro ao carregar perfil:', error);
        });
}

function loadProfileStats() {
    const user = auth.currentUser;
    
    db.collection('posts').where('user', '==', user.uid).get()
        .then(snapshot => {
            document.getElementById('profilePosts').innerText = snapshot.size;
        })
        .catch(error => {
            console.error('Erro ao carregar stats:', error);
        });
    
    document.getElementById('profileFollowers').innerText = '128';
    document.getElementById('profileFollowing').innerText = '56';
}

function loadProfilePosts() {
    const user = auth.currentUser;
    
    db.collection('posts').where('user', '==', user.uid).get()
        .then(snapshot => {
            const grid = document.getElementById('profilePostsGrid');
            grid.innerHTML = '';
            
            if (snapshot.empty) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--text-secondary);">Voc√™ ainda n√£o tem posts</div>';
                return;
            }
            
            const posts = [];
            snapshot.forEach(doc => {
                posts.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            posts.sort((a, b) => {
                const dateA = a.created ? new Date(a.created.seconds * 1000) : new Date(0);
                const dateB = b.created ? new Date(b.created.seconds * 1000) : new Date(0);
                return dateB - dateA;
            });
            
            posts.slice(0, 6).forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post-thumb';
                postElement.innerHTML = `
                    <p>${post.text.substring(0, 60)}${post.text.length > 60 ? '...' : ''}</p>
                    <div class="post-thumb-date">${formatDate(post.created)}</div>
                `;
                grid.appendChild(postElement);
            });
        })
        .catch(error => {
            console.error('Erro ao carregar posts do perfil:', error);
            document.getElementById('profilePostsGrid').innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: var(--danger);">Erro ao carregar posts</div>';
        });
}

function toggleEditProfile() {
    const form = document.getElementById('editProfileForm');
    if (!form) {
        const editForm = document.createElement('div');
        editForm.id = 'editProfileForm';
        editForm.className = 'edit-section';
        editForm.innerHTML = `
            <h4>
                <i data-lucide="edit-3"></i>
                Editar Perfil
            </h4>
            <input type="text" id="editName" placeholder="Seu nome">
            <textarea id="editBio" maxlength="200" placeholder="Bio (200 caracteres)"></textarea>
            <input type="text" id="editLink" placeholder="Link do seu site">
            <div class="edit-section-actions">
                <button class="btn btn-primary" onclick="saveProfile()">Salvar</button>
                <button class="btn btn-secondary" onclick="toggleEditProfile()">Cancelar</button>
            </div>
        `;
        document.querySelector('.profile-container').insertBefore(editForm, document.querySelector('.user-card'));
        lucide.createIcons();
        
        const user = auth.currentUser;
        db.collection('users').doc(user.uid).get().then(doc => {
            const data = doc.data();
            document.getElementById('editName').value = data.displayName || '';
            document.getElementById('editBio').value = data.bio || '';
            document.getElementById('editLink').value = data.link || '';
        });
    } else {
        form.classList.toggle('hidden');
    }
}

function saveProfile() {
    const name = document.getElementById('editName').value;
    const bio = document.getElementById('editBio').value;
    const link = document.getElementById('editLink').value;
    
    db.collection('users').doc(auth.currentUser.uid).update({
        displayName: name,
        bio: bio,
        link: link
    })
    .then(() => {
        loadProfile();
        toggleEditProfile();
        alert('Perfil atualizado com sucesso!');
    })
    .catch(error => {
        console.error('Erro ao atualizar perfil:', error);
        alert('Erro ao atualizar perfil: ' + error.message);
    });
}

function toggleSettings() {
    const panel = document.getElementById('settingsPanel');
    panel.classList.toggle('hidden');
}

function saveSettings() {
    const whatsappDDI = document.getElementById('whatsappDDI').value;
    const whatsapp = document.getElementById('editWhatsApp').value;
    const phoneDDI = document.getElementById('phoneDDI').value;
    const phone = document.getElementById('editPhone').value;
    const birthDate = document.getElementById('editBirthDate').value;
    const gender = document.getElementById('editGender').value;
    
    db.collection('users').doc(auth.currentUser.uid).update({
        whatsappDDI: whatsappDDI,
        whatsapp: whatsapp,
        phoneDDI: phoneDDI,
        phone: phone,
        birthDate: birthDate,
        gender: gender
    })
    .then(() => {
        toggleSettings();
        alert('Configura√ß√µes salvas com sucesso!');
    })
    .catch(error => {
        console.error('Erro ao salvar configura√ß√µes:', error);
        alert('Erro ao salvar configura√ß√µes: ' + error.message);
    });
}

function toggleUserCardForm() {
    const form = document.getElementById('userCardForm');
    form.classList.toggle('hidden');
    
    if (!form.classList.contains('hidden')) {
        loadCurrentUserCard();
    }
}

function loadCurrentUserCard() {
    const user = auth.currentUser;
    
    db.collection('user_cards').where('userId', '==', user.uid).get()
        .then(snapshot => {
            if (!snapshot.empty) {
                let latest = null;
                let latestDate = null;
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const date = data.created ? new Date(data.created.seconds * 1000) : new Date(0);
                    
                    if (!latestDate || date > latestDate) {
                        latestDate = date;
                        latest = data;
                    }
                });
                
                if (latest) {
                    document.getElementById('editWeight').value = latest.weight || '';
                    document.getElementById('editHeight').value = latest.height || '';
                    document.getElementById('editAge').value = latest.age || '';
                    document.getElementById('editGoal').value = latest.goal || '';
                    document.getElementById('editNotes').value = latest.notes || '';
                    calculateIMC();
                }
            } else {
                document.getElementById('editWeight').value = '';
                document.getElementById('editHeight').value = '';
                document.getElementById('editAge').value = '';
                document.getElementById('editGoal').value = '';
                document.getElementById('editNotes').value = '';
            }
        })
        .catch(error => {
            console.error('Erro ao carregar ficha:', error);
        });
}

function calculateIMC() {
    const weight = parseFloat(document.getElementById('editWeight').value);
    const height = parseFloat(document.getElementById('editHeight').value);
    
    if (weight && height) {
        const heightInMeters = height / 100;
        const imc = weight / (heightInMeters * heightInMeters);
        document.getElementById('editImc').value = imc.toFixed(2);
    } else {
        document.getElementById('editImc').value = '';
    }
}

function saveUserCard() {
    if (!auth.currentUser) {
        alert('Voc√™ precisa estar logado para salvar a ficha');
        return;
    }
    
    const weight = parseFloat(document.getElementById('editWeight').value);
    const height = parseFloat(document.getElementById('editHeight').value);
    const age = parseInt(document.getElementById('editAge').value);
    const goal = document.getElementById('editGoal').value;
    const notes = document.getElementById('editNotes').value;
    
    if (isNaN(weight) || weight <= 0) {
        alert('Por favor, preencha um peso v√°lido');
        return;
    }
    
    if (isNaN(height) || height <= 0) {
        alert('Por favor, preencha uma altura v√°lida');
        return;
    }
    
    if (isNaN(age) || age <= 0 || age > 120) {
        alert('Por favor, preencha uma idade v√°lida');
        return;
    }
    
    const btn = event.target;
    const originalText = btn.innerText;
    btn.innerText = 'Salvando...';
    btn.disabled = true;
    
    const user = auth.currentUser;
    const cardData = {
        userId: user.uid,
        weight: weight,
        height: height,
        age: age,
        goal: goal || '',
        notes: notes || '',
        created: new Date()
    };
    
    console.log('Salvando ficha no Firestore:', cardData);
    
    db.collection('user_cards').add(cardData)
        .then((docRef) => {
            console.log('‚úÖ Ficha salva com sucesso! ID:', docRef.id);
            alert('Ficha salva com sucesso!');
            
            toggleUserCardForm();
            loadUserCard();
            loadProgressHistory();
        })
        .catch(error => {
            console.error('‚ùå Erro ao salvar ficha:', error);
            
            if (error.code === 'permission-denied') {
                alert('Erro de permiss√£o: Voc√™ n√£o tem permiss√£o para salvar dados. Verifique as regras do Firestore.');
            } else if (error.code === 'unavailable') {
                alert('Erro de conex√£o: N√£o foi poss√≠vel conectar ao banco de dados. Verifique sua internet.');
            } else {
                alert('Erro ao salvar ficha: ' + error.message);
            }
        })
        .finally(() => {
            btn.innerText = originalText;
            btn.disabled = false;
        });
}

function loadUserCard() {
    const user = auth.currentUser;
    const grid = document.getElementById('userCardGrid');
    
    db.collection('user_cards')
        .where('userId', '==', user.uid)
        .get()
        .then(snapshot => {
            console.log('Carregando fichas...', snapshot.size, 'encontradas');
            
            if (snapshot.empty) {
                console.log('Nenhuma ficha encontrada');
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: var(--text-secondary);">
                        Nenhum dado cadastrado ainda. Clique em "Adicionar dados" para come√ßar.
                    </div>
                `;
                return;
            }
            
            let latestDoc = null;
            let latestDate = null;
            
            snapshot.forEach(doc => {
                const data = doc.data();
                const date = data.created ? new Date(data.created.seconds * 1000) : new Date(0);
                
                if (!latestDate || date > latestDate) {
                    latestDate = date;
                    latestDoc = { id: doc.id, ...data };
                }
            });
            
            if (!latestDoc) {
                grid.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 20px; color: var(--danger);">Erro ao carregar ficha</div>';
                return;
            }
            
            const data = latestDoc;
            console.log('Ficha mais recente carregada:', data);
            
            const heightInMeters = data.height / 100;
            const imc = (data.weight / (heightInMeters * heightInMeters)).toFixed(2);
            
            let imcClass = '';
            let imcStatus = '';
            if (imc < 18.5) {
                imcClass = 'warning';
                imcStatus = 'Abaixo do peso';
            } else if (imc < 25) {
                imcClass = 'success';
                imcStatus = 'Peso normal';
            } else if (imc < 30) {
                imcClass = 'warning';
                imcStatus = 'Sobrepeso';
            } else {
                imcClass = 'danger';
                imcStatus = 'Obesidade';
            }
            
            grid.innerHTML = `
                <div class="user-card-item">
                    <div class="user-card-label">
                        <i data-lucide="scale" size="14"></i>
                        Peso
                    </div>
                    <div class="user-card-value">${data.weight} <small>kg</small></div>
                </div>
                <div class="user-card-item">
                    <div class="user-card-label">
                        <i data-lucide="ruler" size="14"></i>
                        Altura
                    </div>
                    <div class="user-card-value">${data.height} <small>cm</small></div>
                </div>
                <div class="user-card-item">
                    <div class="user-card-label">
                        <i data-lucide="calendar" size="14"></i>
                        Idade
                    </div>
                    <div class="user-card-value">${data.age} <small>anos</small></div>
                </div>
                <div class="user-card-item">
                    <div class="user-card-label">
                        <i data-lucide="activity" size="14"></i>
                        IMC
                    </div>
                    <div class="user-card-value" style="color: var(--${imcClass})">${imc}</div>
                    <div style="font-size: 12px; color: var(--${imcClass})">${imcStatus}</div>
                </div>
                <div class="user-card-item" style="grid-column: span 2;">
                    <div class="user-card-label">
                        <i data-lucide="target" size="14"></i>
                        Objetivo
                    </div>
                    <div class="user-card-value">${getGoalName(data.goal)}</div>
                </div>
                ${data.notes ? `
                <div class="user-card-item" style="grid-column: span 2;">
                    <div class="user-card-label">
                        <i data-lucide="file-text" size="14"></i>
                        Observa√ß√µes
                    </div>
                    <div class="user-card-value" style="font-size: 14px;">${data.notes}</div>
                </div>
                ` : ''}
            `;
            
            lucide.createIcons();
        })
        .catch(error => {
            console.error('Erro ao carregar ficha:', error);
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 20px; color: var(--danger);">
                    Erro ao carregar ficha: ${error.message}
                </div>
            `;
        });
}

function loadProgressHistory() {
    const user = auth.currentUser;
    const timeline = document.getElementById('progressTimeline');
    
    db.collection('user_cards')
        .where('userId', '==', user.uid)
        .get()
        .then(snapshot => {
            console.log('Carregando hist√≥rico...', snapshot.size, 'registros encontrados');
            
            if (snapshot.size <= 1) {
                timeline.innerHTML = '<div style="text-align: center; padding: 20px; color: var(--text-secondary);">Atualize sua ficha para ver seu hist√≥rico de progresso</div>';
                return;
            }
            
            const cards = [];
            snapshot.forEach(doc => {
                cards.push({
                    id: doc.id,
                    ...doc.data()
                });
            });
            
            cards.sort((a, b) => {
                const dateA = a.created ? new Date(a.created.seconds * 1000) : new Date(0);
                const dateB = b.created ? new Date(b.created.seconds * 1000) : new Date(0);
                return dateB - dateA;
            });
            
            timeline.innerHTML = '';
            
            cards.forEach((data) => {
                const heightInMeters = data.height / 100;
                const imc = (data.weight / (heightInMeters * heightInMeters)).toFixed(2);
                
                let imcClass = '';
                if (imc < 18.5) imcClass = 'warning';
                else if (imc < 25) imcClass = 'success';
                else if (imc < 30) imcClass = 'warning';
                else imcClass = 'danger';
                
                const item = document.createElement('div');
                item.className = 'timeline-item';
                item.innerHTML = `
                    <div class="timeline-date">${formatDate(data.created)}</div>
                    <div class="timeline-content">
                        <p><strong>Peso:</strong> ${data.weight} kg</p>
                        <p><strong>Altura:</strong> ${data.height} cm</p>
                        <p><strong>Idade:</strong> ${data.age} anos</p>
                        <p><strong>IMC:</strong> <span style="color: var(--${imcClass})">${imc}</span></p>
                        ${data.goal ? `<p><strong>Objetivo:</strong> ${getGoalName(data.goal)}</p>` : ''}
                        ${data.notes ? `<p><strong>Obs:</strong> ${data.notes}</p>` : ''}
                    </div>
                `;
                timeline.appendChild(item);
            });
        })
        .catch(error => {
            console.error('Erro ao carregar hist√≥rico:', error);
            timeline.innerHTML = `
                <div style="text-align: center; padding: 20px; color: var(--danger);">
                    Erro ao carregar hist√≥rico: ${error.message}
                </div>
            `;
        });
}

function getGoalName(goal) {
    const goals = {
        'emagrecimento': 'Emagrecimento',
        'hipertrofia': 'Hipertrofia',
        'definicao': 'Defini√ß√£o muscular',
        'saude': 'Sa√∫de e bem-estar',
        'resistencia': 'Resist√™ncia'
    };
    return goals[goal] || goal || 'N√£o definido';
}

function formatDate(date) {
    if (!date) return 'Data desconhecida';
    
    let d;
    if (date && typeof date === 'object' && date.seconds) {
        d = new Date(date.seconds * 1000);
    } else if (date instanceof Date) {
        d = date;
    } else {
        return 'Data desconhecida';
    }
    
    const now = new Date();
    const diff = now - d;
    
    if (diff < 60000) return 'Agora mesmo';
    if (diff < 3600000) return `${Math.floor(diff / 60000)} minutos atr√°s`;
    if (diff < 86400000) return `${Math.floor(diff / 3600000)} horas atr√°s`;
    if (diff < 604800000) return `${Math.floor(diff / 86400000)} dias atr√°s`;
    
    return d.toLocaleDateString('pt-BR');
}

function formatTime(date) {
    if (!date) return '';
    
    let d;
    if (date && typeof date === 'object' && date.seconds) {
        d = new Date(date.seconds * 1000);
    } else if (date instanceof Date) {
        d = date;
    } else {
        return '';
    }
    
    const now = new Date();
    const diff = now - d;
    
    if (diff < 60000) return 'agora';
    if (diff < 3600000) return `${Math.floor(diff / 60000)}min`;
    if (diff < 86400000) {
        return d.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', hour12: false });
    }
    
    return d.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
}

function likePost(postId) {
    const postRef = db.collection('posts').doc(postId);
    
    postRef.get().then(doc => {
        if (doc.exists) {
            const likes = (doc.data().likes || 0) + 1;
            postRef.update({ likes: likes });
        }
    }).catch(error => {
        console.error('Erro ao dar like:', error);
    });
}

function commentPost(postId) {
    alert('Funcionalidade de coment√°rios em breve!');
}

function sharePost(postId) {
    alert('Funcionalidade de compartilhamento em breve!');
}

function loadReadTimestamps() {
    const readData = JSON.parse(localStorage.getItem('readTimestamps') || '{}');
    Object.entries(readData).forEach(([userId, timestamp]) => {
        lastReadTimestamps.set(userId, timestamp);
    });
}

loadReadTimestamps();

// CORRE√á√ÉO: For√ßar atualiza√ß√£o do layout em mobile
window.addEventListener('resize', function() {
    if (window.innerWidth > 768) {
        document.getElementById('chatSidebar').classList.remove('hidden-mobile');
        document.getElementById('chatMain').classList.remove('active');
    }
});
</script>

</body>
</html>
